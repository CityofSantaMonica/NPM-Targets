<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target
    Name="NpmInstall"
    AfterTargets="AfterResolveReferences"
    BeforeTargets="NpmDotnetPrebuild;BeforeBuild"
    Inputs="package.json"
    Outputs="$(NpmInstallStampFile)"
    Condition="'$(ExecNpmInstallCommand)' == 'true' AND Exists('package.json')">
    <Exec Command="$(NpmInstallCommand)" />
    <MakeDir Directories="$(NodeModulesFolderPath)" Condition="!Exists($(NodeModulesFolderPath))"/>
    <Touch Files="$(NpmInstallStampFile)" AlwaysCreate="true" Condition="'$(CreateNpmInstallStampFile)' == 'true'" />
  </Target>

  <Target
    Name="DeleteDotnetPrebuildStampFile"
    AfterTargets="Clean"
    Condition="Exists($(NpmDotnetPrebuildStampFile))">
    <Delete Files="$(NpmDotnetPrebuildStampFile)" />
  </Target>

  <Target
    Name="NpmDotnetPostclean"
    AfterTargets="Clean"
    Condition="'$(ExecDotnetPostcleanCommand)' == 'true'">
    <Exec Command="$(NpmDotnetPostcleanCommand)" />
  </Target>

  <Target
    Name="NpmDotnetPrebuild"
    AfterTargets="InitCommonNodeModules;NpmInstall"
    BeforeTargets="EmbeddModuleAssets;BeforeBuild"
    Inputs="@(NpmDotnetPrebuildWatchedFiles)"
    Outputs="$(NpmDotnetPrebuildStampFile)"
    Condition="'$(ExecDotnetPrebuildCommand)' == 'true' AND Exists('package.json')">
    <Exec Command="$(NpmDotnetPrebuildCommand)" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" PropertyName="OutputOfExec"/>
    </Exec>
    <Touch Files="$(NpmDotnetPrebuildStampFile)" AlwaysCreate="true" Condition="'$(CreateDotnetPrebuildStampFile)' == 'true'"  />
    <Error
      Code="ESLINT001"
      Text="ESLint Error, check output for more info!"
      ContinueOnError="true"
      Condition="$($(OutputOfExec).Contains('ESLintError'))"/>
  </Target>

  <!--Condition="$([System.IO.File]::ReadAllText($(NpmDotnetPrebuildStampFile)).Contains('ESLintError'))" />-->

  <!--<Target Name="TestForError">
    <ReadLinesFromFile File="$(NpmDotnetPrebuildStampFile)">
      <Output TaskParameter="Lines" ItemName="Value"/>
    </ReadLinesFromFile>
    <Error
      Code="ESLINT001"
      Text="ESLint Error, check output for more info!"
      ContinueOnError="true"
      Condition="$([System.IO.File]::ReadAllText($(NpmDotnetPrebuildStampFile)).Contains(''))" />  
  </Target>-->

</Project>
